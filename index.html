<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ScaleMaster - Standalone Piano Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        /* Prevent text selection */
        .no-select {
            user-select: none;
            -webkit-user-select: none;
        }
        /* Piano Key Animations */
        .piano-key:active {
            transform: scale(0.98);
            transform-origin: top;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3"
  }
}
</script>
</head>
<body class="bg-slate-950 text-slate-100 antialiased min-h-screen flex flex-col items-center py-12 px-4 font-sans">

    <!-- Header -->
    <header class="mb-10 text-center">
        <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400 mb-4">
            ScaleMaster
        </h1>
        <p class="text-slate-400 text-lg">
            Interactive Piano Scale & Chord Visualizer
        </p>
    </header>

    <!-- Controls Container -->
    <div class="w-full max-w-4xl grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 p-6 bg-slate-900/50 backdrop-blur-sm rounded-2xl border border-slate-800 shadow-xl">
        
        <!-- Root Selection -->
        <div class="space-y-3">
            <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Root Key</label>
            <div class="flex flex-wrap gap-2" id="root-container">
                <!-- Generated by JS -->
            </div>
        </div>

        <!-- Scale Selection -->
        <div class="space-y-3">
            <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Scale Type</label>
            <div class="relative">
                <select id="scale-select" class="w-full bg-slate-800 text-white border border-slate-700 rounded-xl px-4 py-3 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 hover:bg-slate-750 cursor-pointer">
                    <!-- Generated by JS -->
                </select>
                <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400">
                    <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" /></svg>
                </div>
            </div>
        </div>

        <!-- Focus Mode -->
        <div class="space-y-3">
            <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Focus Mode</label>
            <div class="flex flex-col gap-2" id="focus-container">
                <!-- Generated by JS -->
            </div>
        </div>
    </div>

    <!-- Piano Display -->
    <main class="flex flex-col items-center w-full overflow-x-auto pb-8">
        <div class="bg-slate-900 p-8 rounded-3xl border border-slate-800 shadow-[0_20px_50px_rgba(0,0,0,0.5)]">
            <div class="relative inline-flex px-4 py-8 bg-slate-900 rounded-xl shadow-2xl border-t-8 border-slate-800 overflow-x-auto max-w-full">
                <!-- Decorative Felt Strip -->
                <div class="absolute top-0 left-0 right-0 h-3 bg-red-900/80 shadow-inner pointer-events-none rounded-t-sm z-30"></div>
                
                <!-- Keys Container -->
                <div class="flex relative" id="piano-keys">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="flex flex-wrap justify-center gap-6 mt-8">
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]"></div>
                <span class="text-sm text-slate-300">Root</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]"></div>
                <span class="text-sm text-slate-300">Chord Tone (3, 5, 7)</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 rounded-full bg-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.5)]"></div>
                <span class="text-sm text-slate-300">Extension (6 / 13)</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-4 h-4 rounded-full bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
                <span class="text-sm text-slate-300">Scale Note (2, 4)</span>
            </div>
        </div>
    </main>

    <footer class="mt-auto pt-10 text-slate-600 text-sm">
        <p>Built for musicians â€¢ Vanilla JS + Tailwind</p>
    </footer>

    <script>
        // --- DATA & CONSTANTS ---
        const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const OCTAVES = 3;
        const START_OCTAVE = 3;

        const SCALES = [
            // Basic
            { name: 'Major', intervals: [0, 2, 4, 5, 7, 9, 11], category: 'Basic' },
            { name: 'Natural Minor', intervals: [0, 2, 3, 5, 7, 8, 10], category: 'Basic' },
            { name: 'Harmonic Minor', intervals: [0, 2, 3, 5, 7, 8, 11], category: 'Basic' },
            { name: 'Melodic Minor', intervals: [0, 2, 3, 5, 7, 9, 11], category: 'Basic' },
            // Pentatonic
            { name: 'Major Pentatonic', intervals: [0, 2, 4, 7, 9], category: 'Pentatonic' },
            { name: 'Minor Pentatonic', intervals: [0, 3, 5, 7, 10], category: 'Pentatonic' },
            { name: 'Blues', intervals: [0, 3, 5, 6, 7, 10], category: 'Pentatonic' },
            // Modes
            { name: 'Ionian', intervals: [0, 2, 4, 5, 7, 9, 11], category: 'Modes' },
            { name: 'Dorian', intervals: [0, 2, 3, 5, 7, 9, 10], category: 'Modes' },
            { name: 'Phrygian', intervals: [0, 1, 3, 5, 7, 8, 10], category: 'Modes' },
            { name: 'Lydian', intervals: [0, 2, 4, 6, 7, 9, 11], category: 'Modes' },
            { name: 'Mixolydian', intervals: [0, 2, 4, 5, 7, 9, 10], category: 'Modes' },
            { name: 'Aeolian', intervals: [0, 2, 3, 5, 7, 8, 10], category: 'Modes' },
            { name: 'Locrian', intervals: [0, 1, 3, 5, 6, 8, 10], category: 'Modes' },
            // Advanced
            { name: 'Bebop Major', intervals: [0, 2, 4, 5, 7, 8, 9, 11], category: 'Advanced' },
            { name: 'Bebop Dominant', intervals: [0, 2, 4, 5, 7, 9, 10, 11], category: 'Advanced' },
            { name: 'Altered', intervals: [0, 1, 3, 4, 6, 8, 10], category: 'Advanced' },
            { name: 'Whole Tone', intervals: [0, 2, 4, 6, 8, 10], category: 'Advanced' },
            { name: 'Diminished (H-W)', intervals: [0, 1, 3, 4, 6, 7, 9, 10], category: 'Advanced' },
            { name: 'Diminished (W-H)', intervals: [0, 2, 3, 5, 6, 8, 9, 11], category: 'Advanced' },
        ];

        // --- STATE ---
        const state = {
            root: 'C',
            scaleName: 'Major',
            focusMode: 'All' // 'All', 'Chord', 'Root'
        };

        // --- AUDIO ENGINE ---
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        function playTone(noteStr) {
            initAudio();
            
            const noteMap = { 'C': -9, 'C#': -8, 'D': -7, 'D#': -6, 'E': -5, 'F': -4, 'F#': -3, 'G': -2, 'G#': -1, 'A': 0, 'A#': 1, 'B': 2 };
            const match = noteStr.match(/([A-G]#?)(\d)/);
            if (!match) return;

            const noteName = match[1];
            const octave = parseInt(match[2], 10);
            
            const semitonesFromA4 = noteMap[noteName] + (octave - 4) * 12;
            const frequency = 440 * Math.pow(2, semitonesFromA4 / 12);

            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.type = 'triangle';
            osc.frequency.setValueAtTime(frequency, audioContext.currentTime);

            gain.gain.setValueAtTime(0.1, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 1.0);

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.start();
            osc.stop(audioContext.currentTime + 1.0);
        }

        // --- MUSIC THEORY LOGIC ---
        function getHighlightType(interval, scaleIntervals) {
            if (interval === 0) return 'Root';

            const hasPerfectFifth = scaleIntervals.includes(7);
            const hasSeventh = scaleIntervals.includes(10) || scaleIntervals.includes(11);

            // 3rds
            if (interval === 3 || interval === 4) return 'Chord';
            
            // 5ths
            if (interval === 7) return 'Chord';
            if (interval === 6) return hasPerfectFifth ? 'Scale' : 'Chord'; // b5 vs #4
            if (interval === 8) return hasPerfectFifth ? 'Extension' : 'Chord'; // b6 vs #5

            // 7ths
            if (interval === 10 || interval === 11) return 'Chord';

            // 6th/13th
            if (interval === 9) {
                if (hasSeventh || hasPerfectFifth) return 'Extension';
                return 'Chord'; // bb7
            }

            // 2nds, 4ths
            return 'Scale';
        }

        function calculateHighlights(root, scaleName, startOctave, octaveCount) {
            const highlights = new Map();
            const scale = SCALES.find(s => s.name === scaleName);
            if (!scale) return highlights;

            const totalNotes = octaveCount * 12 + 1;
            const rootIndex = NOTES.indexOf(root);

            for (let i = 0; i < totalNotes; i++) {
                const currentOctave = startOctave + Math.floor(i / 12);
                const noteIndex = i % 12;
                const noteName = NOTES[noteIndex];
                
                // Interval from root
                let intervalFromRoot = (NOTES.indexOf(noteName) - rootIndex);
                if (intervalFromRoot < 0) intervalFromRoot += 12;

                const keyId = `${noteName}${currentOctave}`;

                if (scale.intervals.includes(intervalFromRoot)) {
                    const type = getHighlightType(intervalFromRoot, scale.intervals);
                    highlights.set(keyId, type);
                } else {
                    highlights.set(keyId, 'None');
                }
            }
            return highlights;
        }

        // --- DOM RENDERERS ---

        function renderRootSelector() {
            const container = document.getElementById('root-container');
            container.innerHTML = NOTES.map(note => `
                <button 
                    onclick="updateState('root', '${note}')"
                    class="w-10 h-10 rounded-lg text-sm font-bold transition-all ${state.root === note 
                        ? 'bg-red-500 text-white shadow-lg shadow-red-500/30 scale-105' 
                        : 'bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white'}"
                >${note}</button>
            `).join('');
        }

        function renderScaleSelector() {
            const select = document.getElementById('scale-select');
            const grouped = SCALES.reduce((acc, s) => {
                if(!acc[s.category]) acc[s.category] = [];
                acc[s.category].push(s);
                return acc;
            }, {});

            select.innerHTML = Object.keys(grouped).map(cat => `
                <optgroup label="${cat}" class="bg-slate-900 text-slate-300">
                    ${grouped[cat].map(s => `
                        <option value="${s.name}" ${state.scaleName === s.name ? 'selected' : ''}>${s.name}</option>
                    `).join('')}
                </optgroup>
            `).join('');

            select.onchange = (e) => updateState('scaleName', e.target.value);
        }

        function renderFocusMode() {
            const container = document.getElementById('focus-container');
            const modes = [
                { id: 'All', label: 'All Notes' },
                { id: 'Chord', label: 'Chord Tones Only' },
                { id: 'Root', label: 'Root Only' }
            ];

            container.innerHTML = modes.map(m => `
                <label class="flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-slate-800/50 transition-colors group" onclick="updateState('focusMode', '${m.id}')">
                    <div class="w-5 h-5 rounded-full border-2 flex items-center justify-center ${state.focusMode === m.id ? 'border-blue-500' : 'border-slate-600 group-hover:border-slate-500'}">
                        ${state.focusMode === m.id ? '<div class="w-2.5 h-2.5 bg-blue-500 rounded-full"></div>' : ''}
                    </div>
                    <span class="${state.focusMode === m.id ? 'text-white' : 'text-slate-400 group-hover:text-slate-300'}">
                        ${m.label}
                    </span>
                </label>
            `).join('');
        }

        function renderPiano() {
            const container = document.getElementById('piano-keys');
            const highlights = calculateHighlights(state.root, state.scaleName, START_OCTAVE, OCTAVES);
            const totalNotes = OCTAVES * 12 + 1;

            let html = '';

            for (let i = 0; i < totalNotes; i++) {
                const currentOctave = START_OCTAVE + Math.floor(i / 12);
                const noteIndex = i % 12;
                const noteName = NOTES[noteIndex];
                const keyId = `${noteName}${currentOctave}`;
                const isBlack = noteName.includes('#');
                
                let type = highlights.get(keyId) || 'None';

                // Focus Mode Logic
                if (state.focusMode === 'Root' && type !== 'Root') type = 'None';
                if (state.focusMode === 'Chord' && (type === 'Scale' || type === 'None')) type = 'None';
                // Note: Keep Extensions visible in Chord mode? 
                // The previous react code logic: if (focusMode === 'Chord' && highlight === HighlightType.Scale) highlight = None;
                // So Extensions (Yellow) would remain visible in Chord mode, which is correct for jazz chords.

                let bgClass = '';
                let textClass = '';
                let shadowStyle = '';

                // Color Mapping
                switch(type) {
                    case 'Root':
                        bgClass = 'bg-red-500 hover:bg-red-400 z-10';
                        shadowStyle = 'box-shadow: 0 0 15px rgba(239,68,68,0.6);';
                        textClass = 'text-white font-bold';
                        break;
                    case 'Chord':
                        bgClass = 'bg-green-500 hover:bg-green-400 z-10';
                        shadowStyle = 'box-shadow: 0 0 15px rgba(34,197,94,0.6);';
                        textClass = 'text-white font-bold';
                        break;
                    case 'Extension':
                        bgClass = 'bg-yellow-400 hover:bg-yellow-300 z-10';
                        shadowStyle = 'box-shadow: 0 0 15px rgba(250,204,21,0.6);';
                        textClass = 'text-slate-900 font-bold';
                        break;
                    case 'Scale':
                        bgClass = 'bg-blue-500 hover:bg-blue-400 z-10';
                        shadowStyle = 'box-shadow: 0 0 15px rgba(59,130,246,0.6);';
                        textClass = 'text-white font-bold';
                        break;
                    default:
                        bgClass = isBlack ? 'bg-slate-900 hover:bg-slate-800' : 'bg-white hover:bg-slate-100';
                        textClass = isBlack ? 'text-slate-500' : 'text-slate-400';
                        // Add inset shadows for realism if not highlighted
                        if(!isBlack) shadowStyle = 'box-shadow: inset 0 -10px 20px rgba(0,0,0,0.1), 0 2px 5px rgba(0,0,0,0.2);';
                        else shadowStyle = 'box-shadow: inset 0 -5px 10px rgba(255,255,255,0.1), 2px 5px 5px rgba(0,0,0,0.4);';
                }

                // Render Key
                if (isBlack) {
                    html += `
                        <div 
                            onclick="playTone('${keyId}')"
                            class="piano-key relative flex items-end justify-center rounded-b-md transition-all duration-200 cursor-pointer border-x border-b border-slate-800 w-[36px] h-[180px] z-20 -mx-[18px] no-select ${bgClass}"
                            style="${shadowStyle}"
                        >
                            ${(type !== 'None') ? `<span class="mb-3 text-xs ${textClass}">${noteName}</span>` : ''}
                        </div>
                    `;
                } else {
                    html += `
                        <div 
                            onclick="playTone('${keyId}')"
                            class="piano-key relative flex items-end justify-center rounded-b-md transition-all duration-200 cursor-pointer border border-slate-300 w-[60px] h-[280px] z-10 active:scale-[0.99] active:origin-top no-select ${bgClass}"
                            style="${shadowStyle}"
                        >
                            ${(type !== 'None' || !isBlack) ? `
                                <span class="mb-4 text-sm ${textClass}">
                                    ${noteName}
                                    <span class="text-[10px] opacity-70 align-top ml-0.5">${currentOctave}</span>
                                </span>
                            ` : ''}
                        </div>
                    `;
                }
            }

            container.innerHTML = html;
        }

        // --- INITIALIZATION ---

        function updateState(key, value) {
            state[key] = value;
            renderRootSelector();
            renderScaleSelector(); // To update selected attr if needed
            renderFocusMode();
            renderPiano();
        }

        // Initial Render
        renderRootSelector();
        renderScaleSelector();
        renderFocusMode();
        renderPiano();

    </script>
</body>
</html>
